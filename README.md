# Вещи, которые вам нужно знать перед установкой

- Это бета-версия, которая находится в активной разработке. Из версии в версию что-то может меняться.
- При возникновении проблем, нужен технически грамотный фидбэк в чат.
- При обновлении **обязательно** [сбрасывайте кэш LuCI](https://podkop.net/docs/clear-browser-cache/).
- Также при обновлении всегда заходите в конфигурацию и проверяйте свои настройки. Конфигурация может измениться.
- Необходимо минимум 15МБ свободного места на роутере. Роутеры с флешками на 16МБ сразу мимо.
- При старте программы редактируется конфиг Dnsmasq.
- Podkop редактирует конфиг sing-box. Обязательно сохраните ваш конфиг sing-box перед установкой, если он вам нужен.
- Информация здесь может быть устаревшей. Все изменения фиксируются в [телеграм-чате](https://t.me/itdogchat/81758/420321).
- [Если у вас не что-то не работает.](https://podkop.net/docs/diagnostics/)
- Если у вас установлен Getdomains, [его следует удалить](https://github.com/itdoginfo/domain-routing-openwrt?tab=readme-ov-file#%D1%81%D0%BA%D1%80%D0%B8%D0%BF%D1%82-%D0%B4%D0%BB%D1%8F-%D1%83%D0%B4%D0%B0%D0%BB%D0%B5%D0%BD%D0%B8%D1%8F).

# Документация
https://podkop.net/

## Функциональность подписок

Podkop теперь поддерживает расширенную функциональность подписок, включая:

### Поддерживаемые протоколы
- **VLESS** - с поддержкой TCP, WebSocket, gRPC, HTTP/2 транспортов
- **VMess** - полная поддержка всех транспортов и настроек безопасности
- **Shadowsocks** - включая SIP008 JSON формат
- **Trojan** - с поддержкой TLS и SNI
- **Hysteria** - протокол QUIC с обфускацией
- **Hysteria2** - улучшенная версия с дополнительными возможностями

### Возможности
- **Множественные URL подписок** - поддержка нескольких источников одновременно
- **Автоматическое обновление** - настраиваемые интервалы (1h, 6h, 12h, 24h, 48h, 7d)
- **Фильтрация узлов** - blacklist/whitelist по ключевым словам
- **URLTest агрегация** - автоматический выбор сервера по задержке
- **Управление через UI** - кнопки обновления, тестирования и статуса
- **Расширенная диагностика** - детальная информация о состоянии подписок

### Форматы подписок
- Base64 encoded URI lists
- Plain text URI lists  
- SIP008 JSON format (Shadowsocks)
- Стандартные форматы v2rayN/Xray

### Настройки безопасности
- Поддержка небезопасных TLS соединений
- Настраиваемый User-Agent
- Валидация URL и параметров
- Обработка ошибок и fallback

# Установка Podkop
Полная информация в [документации](https://podkop.net/docs/install/)

Вкратце, достаточно одного скрипта для установки и обновления:
```
sh <(wget -O - https://raw.githubusercontent.com/itdoginfo/podkop/refs/heads/main/install.sh)
```

# ToDo
Этот раздел не означает задачи, которые нужно брать и делать. Это общий список хотелок. Если вы хотите помочь, пожалуйста, спросите сначала в телеграмме.

Основные задачи в issues.

## Рефактор
- [ ] Очевидные повторения в `/usr/bin/podkop` загнать в переменые
- [ ] Возможно поменять структуру

## Списки
- [ ] CloudFront
- [ ] DO 
- [ ] HODCA

## Будущее
- [x] [Подписка](https://github.com/itdoginfo/podkop/issues/118). Реализована полная поддержка подписок с фильтрацией по ключевым словам, множественными URL, автообновлением и поддержкой URLTest/Selector агрегаторов.
- [ ] Опция, когда все запросы (с роутера в первую очередь), а не только br-lan идут в прокси. С этим связана #95. Требуется много переделать для nftables.
- [ ] Весь трафик в Proxy\VPN. Вопрос, что делать с экстрасекциями в этом случае. FakeIP здесь скорее не нужен, а значит только main секция остаётся. Всё что касается fakeip проверок, придётся выключать в этом режиме.
- [x] Поддержка Source format. Нужна расшифровка в json и если присуствуют подсети, заносить их в custom subnet nftset.
- [ ] Переделывание функции формирования кастомных списков в JSON. Обрабатывать сразу скопом, а не по одному.
- [ ] При успешном запуске переходит в фоновый режим и следит за состоянием sing-box. Если вдруг идёт exit 1, выполняется dnsmasq restore и снова следит за состоянием. Вопрос в том, как это искусcтвенно провернуть. Попробовать положить прокси и посмотреть, останется ли работать DNS в этом случае. И здесь, вероятно, можно обойтись триггером в init.d. [Issue](https://github.com/itdoginfo/podkop/issues/111)
- [ ] Формирование конфига sing-box в /tmp
- [ ] Галочка, которая режет доступ к doh серверам.
- [ ] IPv6. Только после наполнения Wiki.

## Тесты
- [ ] Unit тесты (BATS)
- [ ] Интеграционые тесты бекенда (OpenWrt rootfs + BATS)